import {
  collection,
  doc,
  addDoc,
  updateDoc,
  deleteDoc,
  getDoc,
  getDocs,
  runTransaction,
  serverTimestamp,
  WriteBatch,
  increment,
} from "firebase/firestore";
import { db } from "../firebase";

import type {
  CatalogService,
  Consumable,
  ChemicalProduct,
  MaterialRecipe,
  ServiceRecipe,
  ServiceItem,
  MaterialInput,
} from "../types";

// Collection names

const CONSUMABLES_COLLECTION = "consumables";
const CHEMICAL_PRODUCTS_COLLECTION = "chemical_products";

// ====== Catalog Management ======

export const initializeCatalog = async (): Promise<boolean> => {
  try {
    const metaRef = doc(db, "meta", "catalog");
    const metaSnap = await getDoc(metaRef);

    if (metaSnap.exists() && metaSnap.data()?.seeded) return false;

    await runTransaction(db, async (tx) => {
        // Servicios base
        const defaultServices = [
          {
            name: "Manicura en gel 1 solo color",
            category: "manicura",
            basePrice: 12,
          },
          { name: "Manicura con diseÃ±o", category: "manicura", basePrice: 15 },
          {
            name: "UÃ±as acrÃ­licas (base)",
