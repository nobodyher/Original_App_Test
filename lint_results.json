[{"filePath":"D:\\VS\\App_Principal\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\layout\\MobileNavigation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\ConfirmationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\CustomSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\LoadingScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\NotificationToast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\ThemeToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\components\\ui\\UserAvatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\constants\\app.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\constants\\catalog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\context\\SalonContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":72,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":72,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, type ReactNode } from \"react\";\r\nimport type {\r\n  AppUser,\r\n  Service,\r\n  Expense,\r\n  CatalogService,\r\n  CatalogExtra,\r\n  Toast,\r\n  Client,\r\n  InventoryItem,\r\n} from \"../types\";\r\n\r\n// Definición completa de las props que manejará el contexto\r\n// (Espejo de OwnerScreenProps para eliminar prop drilling)\r\nexport interface SalonContextType {\r\n  // Datos\r\n  users: AppUser[];\r\n  currentUser: AppUser | null;\r\n  services: Service[];\r\n  expenses: Expense[];\r\n  catalogServices: CatalogService[];\r\n  catalogExtras: CatalogExtra[];\r\n  clients: Client[];\r\n  inventoryItems: InventoryItem[]; // Unified inventory items\r\n  \r\n  // History Pagination\r\n  historyServices: Service[];\r\n  loadHistory: () => Promise<void>;\r\n  loadingHistory: boolean;\r\n  historyFullyLoaded: boolean;\r\n  \r\n  // Utilidades UI\r\n  showNotification: (message: string, type?: Toast[\"type\"]) => void;\r\n  // onLogout se mantiene fuera o se puede integrar si auth se mueve a contexto global,\r\n  // por ahora lo incluimos para consistencia.\r\n  onLogout: () => void;\r\n\r\n  // Acciones (Actions)\r\n  addExpense: (data: Omit<Expense, \"id\">) => Promise<void>;\r\n  deleteExpense: (id: string) => Promise<void>;\r\n  updateServiceCost: (id: string, cost: number) => Promise<void>;\r\n  softDeleteService: (id: string, userId?: string) => Promise<void>;\r\n  permanentlyDeleteService: (id: string) => Promise<void>;\r\n  restoreDeletedService: (id: string) => Promise<void>;\r\n\r\n  createNewUser: (data: Omit<AppUser, \"id\">) => Promise<void>;\r\n  updateUser: (userId: string, data: Partial<AppUser>) => Promise<void>;\r\n  deleteUserPermanently: (userId: string) => Promise<void>;\r\n\r\n  addCatalogService: (\r\n    name: string,\r\n    basePrice: number,\r\n    tenantId: string\r\n  ) => Promise<string>;\r\n  updateCatalogService: (\r\n    id: string,\r\n    data: Partial<CatalogService>\r\n  ) => Promise<void>;\r\n  deleteCatalogService: (id: string) => Promise<void>;\r\n\r\n  addExtra: (name: string, price: number, tenantId: string) => Promise<string>;\r\n  updateExtra: (id: string, data: Partial<CatalogExtra>) => Promise<void>;\r\n  deleteExtra: (id: string) => Promise<void>;\r\n\r\n  deleteClient: (clientId: string) => Promise<void>;\r\n}\r\n\r\n// 1. Crear el Contexto\r\nconst SalonContext = createContext<SalonContextType | undefined>(undefined);\r\n\r\n// 2. Hook Personalizado\r\nexport const useSalonContext = () => {\r\n  const context = useContext(SalonContext);\r\n  if (!context) {\r\n    throw new Error(\"useSalonContext must be used within a SalonProvider\");\r\n  }\r\n  return context;\r\n};\r\n\r\n// 3. Provider Component\r\ninterface SalonProviderProps extends SalonContextType {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const SalonProvider: React.FC<SalonProviderProps> = ({\r\n  children,\r\n  ...props\r\n}) => {\r\n  return (\r\n    <SalonContext.Provider value={props}>\r\n      {children}\r\n    </SalonContext.Provider>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\MasterAdminScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4145,4148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4145,4148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from \"react\";\r\nimport { collection, getDocs, doc, updateDoc, setDoc, deleteDoc, writeBatch, query, where } from \"firebase/firestore\";\r\nimport { initializeApp, getApps } from \"firebase/app\";\r\nimport { getAuth, createUserWithEmailAndPassword, signOut } from \"firebase/auth\";\r\nimport { db, firebaseConfig } from \"../../firebase\";\r\nimport { hashPin } from \"../../utils/security\";\r\nimport { \r\n  ShieldCheck, RefreshCw, CheckCircle2, XCircle, Loader2, Plus, Trash2, \r\n  AlertTriangle, Download \r\n} from \"lucide-react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport Sidebar from \"../../components/layout/Sidebar\";\r\nimport type { ViewType } from \"../../components/layout/Sidebar\";\r\nimport MobileNavigation from \"../../components/layout/MobileNavigation\";\r\n\r\nimport type { AppUser } from \"../../types\";\r\n\r\ninterface Tenant {\r\n  id: string;\r\n  name: string;\r\n  status: \"active\" | \"suspended\" | string;\r\n}\r\n\r\ninterface MasterAdminScreenProps {\r\n  showNotification: (message: string, type?: \"success\" | \"error\" | \"info\") => void;\r\n  currentUser: AppUser | null;\r\n  onLogout: () => void;\r\n}\r\n\r\nconst MasterAdminScreen: React.FC<MasterAdminScreenProps> = ({ showNotification, currentUser, onLogout }) => {\r\n  const navigate = useNavigate();\r\n  // Removed useAuth(true) to avoid flickering. using props instead.\r\n  \r\n  const [tenants, setTenants] = useState<Tenant[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [updatingId, setUpdatingId] = useState<string | null>(null);\r\n\r\n  // Layout State\r\n  const [isSidebarOpen, setIsSidebarOpen] = useState(true);\r\n  const [isAdminOpen, setIsAdminOpen] = useState(false);\r\n\r\n  // Creation State\r\n  const [isCreating, setIsCreating] = useState(false);\r\n  const [creatingLoading, setCreatingLoading] = useState(false);\r\n  const [newTenantName, setNewTenantName] = useState(\"\");\r\n  const [newTenantId, setNewTenantId] = useState(\"\");\r\n  const [newOwnerName, setNewOwnerName] = useState(\"\");\r\n  const [newOwnerPin, setNewOwnerPin] = useState(\"\");\r\n  const [newOwnerEmail, setNewOwnerEmail] = useState(\"\");\r\n  const [newOwnerPassword, setNewOwnerPassword] = useState(\"\");\r\n\r\n  // Delete Modal State\r\n  const [deleteModalOpen, setDeleteModalOpen] = useState(false);\r\n  const [tenantToDelete, setTenantToDelete] = useState<Tenant | null>(null);\r\n  const [deleteConfirmationId, setDeleteConfirmationId] = useState(\"\");\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  const fetchTenants = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const snap = await getDocs(collection(db, \"tenants\"));\r\n      const data: Tenant[] = snap.docs.map((d) => ({\r\n        id: d.id,\r\n        name: d.data().name ?? d.id,\r\n        status: d.data().status ?? \"active\",\r\n      }));\r\n      setTenants(data);\r\n    } catch (err) {\r\n      console.error(\"Error fetching tenants:\", err);\r\n      showNotification(\"Error al cargar los tenants\", \"error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [showNotification]);\r\n\r\n  useEffect(() => {\r\n    fetchTenants();\r\n  }, [fetchTenants]);\r\n\r\n  const toggleStatus = async (tenant: Tenant) => {\r\n    const newStatus = tenant.status === \"active\" ? \"suspended\" : \"active\";\r\n    setUpdatingId(tenant.id);\r\n    try {\r\n      await updateDoc(doc(db, \"tenants\", tenant.id), { status: newStatus });\r\n      setTenants((prev) =>\r\n        prev.map((t) => (t.id === tenant.id ? { ...t, status: newStatus } : t))\r\n      );\r\n      showNotification(\"Estado del local actualizado correctamente\", \"success\");\r\n    } catch (err) {\r\n      console.error(\"Error updating tenant status:\", err);\r\n      showNotification(\"Error al actualizar el estado\", \"error\");\r\n    } finally {\r\n      setUpdatingId(null);\r\n    }\r\n  };\r\n\r\n  const exportTenantData = async (tenantId: string, salonName: string) => {\r\n    try {\r\n      showNotification(`Iniciando exportación de ${salonName}...`, \"info\");\r\n      \r\n      const collectionsToExport = [\r\n        \"services\",\r\n        \"inventory\",\r\n        \"expenses\",\r\n        \"clients\",\r\n        \"catalog_services\",\r\n        \"catalog_extras\"\r\n      ];\r\n\r\n      const exportData: any = {\r\n        tenantId,\r\n        salonName,\r\n        exportedAt: new Date().toISOString(),\r\n        data: {}\r\n      };\r\n\r\n      // Ejecutar consultas en paralelo\r\n      const promises = collectionsToExport.map(async (colName) => {\r\n        const q = query(collection(db, colName), where(\"tenantId\", \"==\", tenantId));\r\n        const snapshot = await getDocs(q);\r\n        return {\r\n          collection: colName,\r\n          data: snapshot.docs.map(d => ({ id: d.id, ...d.data() }))\r\n        };\r\n      });\r\n\r\n      const results = await Promise.all(promises);\r\n\r\n      results.forEach(result => {\r\n        exportData.data[result.collection] = result.data;\r\n      });\r\n\r\n      // Crear y descargar archivo\r\n      const dataStr = JSON.stringify(exportData, null, 2);\r\n      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);\r\n      \r\n      const exportFileDefaultName = `BACKUP_${salonName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.json`;\r\n\r\n      const linkElement = document.createElement('a');\r\n      linkElement.setAttribute('href', dataUri);\r\n      linkElement.setAttribute('download', exportFileDefaultName);\r\n      linkElement.click();\r\n      \r\n      showNotification(\"Exportación completada exitosamente\", \"success\");\r\n\r\n    } catch (error) {\r\n      console.error(\"Error exporting tenant data:\", error);\r\n      showNotification(\"Error al exportar los datos\", \"error\");\r\n    }\r\n  };\r\n\r\n  const openDeleteModal = (tenant: Tenant) => {\r\n    setTenantToDelete(tenant);\r\n    setDeleteConfirmationId(\"\");\r\n    setDeleteModalOpen(true);\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    if (!tenantToDelete) return;\r\n    if (deleteConfirmationId !== tenantToDelete.id) {\r\n        showNotification(\"El ID no coincide\", \"error\");\r\n        return;\r\n    }\r\n\r\n    setIsDeleting(true);\r\n    try {\r\n        const batchSize = 500;\r\n        const collectionsToCheck = [\r\n            \"users\", \r\n            \"services\", \r\n            \"inventory\", \r\n            \"clients\", \r\n            \"expenses\", \r\n            \"catalog_services\", \r\n            \"catalog_extras\"\r\n        ];\r\n\r\n        // 1. Delete all related documents in batches\r\n        for (const colName of collectionsToCheck) {\r\n            const q = query(collection(db, colName), where(\"tenantId\", \"==\", tenantToDelete.id));\r\n            const snapshot = await getDocs(q);\r\n            \r\n            // Chunk deletions\r\n            const chunks = [];\r\n            for (let i = 0; i < snapshot.docs.length; i += batchSize) {\r\n                chunks.push(snapshot.docs.slice(i, i + batchSize));\r\n            }\r\n\r\n            for (const chunk of chunks) {\r\n                const batch = writeBatch(db);\r\n                chunk.forEach(doc => batch.delete(doc.ref));\r\n                await batch.commit();\r\n            }\r\n        }\r\n\r\n        // 2. Delete the tenant document itself\r\n        await deleteDoc(doc(db, \"tenants\", tenantToDelete.id));\r\n\r\n        showNotification(\"Tenant y todos sus datos eliminados correctamente\", \"success\");\r\n        setDeleteModalOpen(false);\r\n        setTenantToDelete(null);\r\n        fetchTenants();\r\n\r\n    } catch (err) {\r\n        console.error(\"Error deleting tenant:\", err);\r\n        showNotification(\"Error crítico al eliminar tenant. Revisa la consola.\", \"error\");\r\n    } finally {\r\n        setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  // Helper to create user without logging out the admin\r\n  const createOwnerUser = async (email: string, pass: string) => {\r\n    // 1. Initialize a secondary app instance\r\n    const secondaryAppName = \"secondaryApp\";\r\n    let secondaryApp = getApps().find(app => app.name === secondaryAppName);\r\n    \r\n    if (!secondaryApp) {\r\n      secondaryApp = initializeApp(firebaseConfig, secondaryAppName);\r\n    }\r\n\r\n    const secondaryAuth = getAuth(secondaryApp);\r\n\r\n    // 2. Create the user\r\n    const userCredential = await createUserWithEmailAndPassword(secondaryAuth, email, pass);\r\n    const newUid = userCredential.user.uid;\r\n\r\n    // 3. Sign out from secondary app to clean up session\r\n    await signOut(secondaryAuth);\r\n    \r\n    return newUid;\r\n  };\r\n\r\n  const handleCreateTenant = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newTenantName.trim() || !newTenantId.trim() || !newOwnerEmail.trim() || !newOwnerPassword.trim() || !newOwnerName.trim() || !newOwnerPin.trim()) {\r\n      showNotification(\"Todos los campos son obligatorios\", \"error\");\r\n      return;\r\n    }\r\n\r\n    if (newOwnerPassword.length < 6) {\r\n        showNotification(\"La contraseña debe tener al menos 6 caracteres\", \"error\");\r\n        return;\r\n    }\r\n\r\n    setCreatingLoading(true);\r\n    try {\r\n      const hashedPin = await hashPin(newOwnerPin.trim());\r\n\r\n      // 1. Create Authentication User\r\n      const newUid = await createOwnerUser(newOwnerEmail.trim(), newOwnerPassword.trim());\r\n\r\n      // 2. Create User Document\r\n      await setDoc(doc(db, \"users\", newUid), {\r\n        email: newOwnerEmail.trim(),\r\n        role: \"owner\",\r\n        tenantId: newTenantId.trim(),\r\n        name: newOwnerName.trim(), \r\n        pin: hashedPin,\r\n        active: true,\r\n        createdAt: new Date(),\r\n        icon: \"crown\"\r\n      });\r\n\r\n      // 3. Create Tenant Document\r\n      await setDoc(doc(db, \"tenants\", newTenantId.trim()), {\r\n        name: newTenantName.trim(),\r\n        status: \"active\",\r\n      });\r\n\r\n      showNotification(\"Tenant y Usuario creados exitosamente\", \"success\");\r\n      setIsCreating(false);\r\n      \r\n      // Clear form\r\n      setNewTenantName(\"\");\r\n      setNewTenantId(\"\");\r\n      setNewOwnerName(\"\");\r\n      setNewOwnerPin(\"\");\r\n      setNewOwnerEmail(\"\");\r\n      setNewOwnerPassword(\"\");\r\n      \r\n      fetchTenants(); // Refresh list\r\n    } catch (err: unknown) {\r\n      console.error(\"Error creating tenant/user:\", err);\r\n      const error = err as { code?: string; message?: string };\r\n      if (error.code === \"auth/email-already-in-use\") {\r\n        showNotification(\"El email ya está registrado.\", \"error\");\r\n      } else {\r\n        showNotification(\"Error: \" + (error.message || \"Error desconocido\"), \"error\");\r\n      }\r\n    } finally {\r\n      setCreatingLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteTenant = (tenant: Tenant) => {\r\n      openDeleteModal(tenant);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-bg-main overflow-hidden\">\r\n      {/* Sidebar for navigation */}\r\n      <Sidebar\r\n        currentView={\"saas-control\" as ViewType}  \r\n        adminSubTab={null}\r\n        isSidebarOpen={isSidebarOpen}\r\n        setIsSidebarOpen={setIsSidebarOpen}\r\n        isAdminOpen={isAdminOpen}\r\n        setIsAdminOpen={setIsAdminOpen}\r\n        currentUser={currentUser}\r\n        onLogout={() => {\r\n            onLogout();\r\n            navigate(\"/login\");\r\n        }}\r\n        onNavigate={(view) => {\r\n           if (view === \"finance\") {\r\n             navigate(\"/finance\");\r\n           } else {\r\n             // For all other views (dashboard, history, analytics, clients, admin),\r\n             // set the preference and go to the main admin route.\r\n             localStorage.setItem(\"owner_currentView\", view);\r\n             navigate(\"/admin\");\r\n           }\r\n        }}\r\n        onAdminSubTabChange={(tab) => {\r\n             // For subtabs, we set view to admin and the specific subtab\r\n             localStorage.setItem(\"owner_currentView\", \"admin\");\r\n             localStorage.setItem(\"owner_adminSubTab\", tab);\r\n             navigate(\"/admin\");\r\n        }}\r\n        showNotification={showNotification}\r\n      />\r\n\r\n      <MobileNavigation \r\n        currentUser={currentUser}\r\n        currentView={\"saas-control\" as ViewType}\r\n        onNavigate={(view) => {\r\n           if (view === \"finance\") {\r\n             navigate(\"/finance\");\r\n           } else {\r\n             localStorage.setItem(\"owner_currentView\", view);\r\n             navigate(\"/admin\");\r\n           }\r\n        }}\r\n        onAdminSubTabChange={(tab) => {\r\n           localStorage.setItem(\"owner_currentView\", \"admin\");\r\n           localStorage.setItem(\"owner_adminSubTab\", tab);\r\n           navigate(\"/admin\");\r\n        }}\r\n        onLogout={() => {\r\n            onLogout();\r\n            navigate(\"/login\");\r\n        }}\r\n        showNotification={showNotification}\r\n      />\r\n\r\n      <main className=\"flex-1 overflow-y-auto relative bg-background scroll-smooth pt-16 md:pt-0\">\r\n        <div className=\"w-full px-6 py-8 min-h-screen\">\r\n            \r\n          <div className=\"max-w-6xl mx-auto space-y-6\">\r\n            <header className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n              <div>\r\n                <h1 className=\"text-3xl font-black text-text-main tracking-tight flex items-center gap-3\">\r\n                  <ShieldCheck className=\"text-primary-500\" size={32} />\r\n                  SaaS Control\r\n                </h1>\r\n                <p className=\"text-text-muted text-sm mt-1\">\r\n                  Gestión maestra de tenants y suscripciones.\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"flex gap-3\">\r\n                <button\r\n                  onClick={fetchTenants}\r\n                  className=\"p-2 rounded-xl bg-surface border border-border text-text-muted hover:text-primary-500 transition-colors\"\r\n                  title=\"Recargar lista\"\r\n                >\r\n                  <RefreshCw size={20} className={loading ? \"animate-spin\" : \"\"} />\r\n                </button>\r\n                <button\r\n                  onClick={() => setIsCreating(true)}\r\n                  className=\"px-4 py-2 rounded-xl bg-primary-600 text-white font-bold hover:bg-primary-500 shadow-lg shadow-primary-500/20 flex items-center gap-2 transition-all\"\r\n                >\r\n                  <Plus size={20} />\r\n                  Nuevo Usuario\r\n                </button>\r\n              </div>\r\n            </header>\r\n\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n               <div className=\"bg-surface border border-border p-6 rounded-2xl shadow-sm\">\r\n                  <p className=\"text-text-muted text-xs font-bold uppercase tracking-wider\">Total Tenants</p>\r\n                  <p className=\"text-3xl font-black text-text-main mt-2\">{tenants.length}</p>\r\n               </div>\r\n               <div className=\"bg-surface border border-border p-6 rounded-2xl shadow-sm\">\r\n                  <p className=\"text-text-muted text-xs font-bold uppercase tracking-wider\">Activos</p>\r\n                  <p className=\"text-3xl font-black text-green-500 mt-2\">{tenants.filter(t => t.status === 'active').length}</p>\r\n               </div>\r\n               <div className=\"bg-surface border border-border p-6 rounded-2xl shadow-sm\">\r\n                  <p className=\"text-text-muted text-xs font-bold uppercase tracking-wider\">Suspendidos</p>\r\n                  <p className=\"text-3xl font-black text-red-500 mt-2\">{tenants.filter(t => t.status === 'suspended').length}</p>\r\n               </div>\r\n            </div>\r\n\r\n            {/* List */}\r\n            <div className=\"bg-surface border border-border rounded-2xl shadow-sm overflow-hidden animate-fade-in-up\">\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full text-left border-collapse\">\r\n                  <thead>\r\n                    <tr className=\"border-b border-border bg-surface-highlight/50\">\r\n                      <th className=\"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                        Nombre del Local\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                        ID (Tenant)\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                        Estado\r\n                      </th>\r\n                      <th className=\"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider text-right\">\r\n                        Acciones\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"divide-y divide-border\">\r\n                    {loading ? (\r\n                      <tr>\r\n                        <td colSpan={4} className=\"px-6 py-12 text-center\">\r\n                          <Loader2 className=\"animate-spin mx-auto text-primary-500 mb-2\" size={24} />\r\n                          <p className=\"text-sm text-text-muted\">Cargando tenants...</p>\r\n                        </td>\r\n                      </tr>\r\n                    ) : tenants.length === 0 ? (\r\n                      <tr>\r\n                        <td colSpan={4} className=\"px-6 py-12 text-center text-text-muted\">\r\n                          No hay tenants registrados.\r\n                        </td>\r\n                      </tr>\r\n                    ) : (\r\n                      tenants.map((tenant) => {\r\n                        const isActive = tenant.status === \"active\";\r\n                        const isUpdating = updatingId === tenant.id;\r\n\r\n                        return (\r\n                          <tr key={tenant.id} className=\"hover:bg-surface-highlight/30 transition-colors group\">\r\n                            <td className=\"px-6 py-4\">\r\n                              <span className=\"font-bold text-text-main text-sm\">\r\n                                {tenant.name}\r\n                              </span>\r\n                            </td>\r\n                            <td className=\"px-6 py-4\">\r\n                              <code className=\"text-xs font-mono bg-black/20 px-1.5 py-0.5 rounded text-text-dim\">\r\n                                {tenant.id}\r\n                              </code>\r\n                            </td>\r\n                            <td className=\"px-6 py-4\">\r\n                              <div\r\n                                className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold border ${\r\n                                  isActive\r\n                                    ? \"bg-green-500/10 text-green-500 border-green-500/20\"\r\n                                    : \"bg-red-500/10 text-red-500 border-red-500/20\"\r\n                                }`}\r\n                              >\r\n                                {isActive ? (\r\n                                  <CheckCircle2 size={12} />\r\n                                ) : (\r\n                                  <XCircle size={12} />\r\n                                )}\r\n                                {isActive ? \"Activo\" : \"Suspendido\"}\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-6 py-4 text-right flex justify-end gap-2\">\r\n                              {/* EXPORT BUTTON */}\r\n                              <button\r\n                                onClick={() => exportTenantData(tenant.id, tenant.name)}\r\n                                className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-bold border border-cyan-500/20 text-cyan-500 hover:bg-cyan-500/10 hover:border-cyan-500/40 transition-all duration-200 disabled:opacity-50\"\r\n                                title=\"Exportar datos (JSON)\"\r\n                              >\r\n                                <Download size={14} />\r\n                              </button>\r\n\r\n                              <button\r\n                                onClick={() => toggleStatus(tenant)}\r\n                                disabled={isUpdating}\r\n                                className={`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all duration-200 ${\r\n                                  isActive\r\n                                    ? \"border-red-500/20 text-red-500 hover:bg-red-500/10\"\r\n                                    : \"border-green-500/20 text-green-500 hover:bg-green-500/10\"\r\n                                } disabled:opacity-50`}\r\n                              >\r\n                                {isUpdating ? \"...\" : isActive ? \"Suspender\" : \"Activar\"}\r\n                              </button>\r\n\r\n                              <button\r\n                                onClick={() => handleDeleteTenant(tenant)}\r\n                                disabled={isUpdating}\r\n                                className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-bold border border-red-500/20 text-red-500 hover:bg-red-500/10 hover:border-red-500/40 transition-all duration-200 disabled:opacity-50\"\r\n                                title=\"Eliminar permanentemente\"\r\n                              >\r\n                                <Trash2 size={13} />\r\n                              </button>\r\n                            </td>\r\n                          </tr>\r\n                        );\r\n                      })\r\n                    )}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n\r\n      {/* CREATE MODAL */}\r\n      {isCreating && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n          <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\" onClick={() => setIsCreating(false)} />\r\n          <div className=\"relative w-full max-w-lg bg-surface border border-border rounded-2xl shadow-2xl p-6 animate-in zoom-in-95 duration-200\">\r\n            <h2 className=\"text-xl font-black text-text-main mb-6 flex items-center gap-2\">\r\n                <Plus className=\"text-primary-500\" />\r\n                Nuevo Usuario / Negocio\r\n            </h2>\r\n            \r\n            <form onSubmit={handleCreateTenant} className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2\">\r\n                    Nombre del Local\r\n                </label>\r\n                <input\r\n                    type=\"text\"\r\n                    value={newTenantName}\r\n                    onChange={(e) => setNewTenantName(e.target.value)}\r\n                    placeholder=\"Ej: Salon de Belleza Elite\"\r\n                    className=\"w-full bg-surface-highlight border border-border rounded-lg px-4 py-3 text-text-main focus:outline-none focus:ring-2 focus:ring-primary-500/50 transition-all placeholder:text-text-dim/50\"\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2\">\r\n                    ID del Tenant (Identificador Único)\r\n                </label>\r\n                <div className=\"relative\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={newTenantId}\r\n                        onChange={(e) => setNewTenantId(e.target.value)}\r\n                        placeholder=\"Ej: client_1\"\r\n                        className=\"w-full bg-surface-highlight border border-border rounded-lg px-4 py-3 text-text-main focus:outline-none focus:ring-2 focus:ring-primary-500/50 transition-all placeholder:text-text-dim/50 font-mono text-sm\"\r\n                    />\r\n                     <p className=\"text-[10px] text-text-dim mt-1.5 ml-1\">\r\n                        Este será el ID interno del negocio.\r\n                     </p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"border-t border-border/50 pt-4 mt-2\">\r\n                <p className=\"text-xs font-bold text-primary-500 uppercase tracking-wider mb-4\">\r\n                    Cuenta del Dueño\r\n                </p>\r\n                \r\n                <div className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2\">\r\n                            Nombre del Dueño\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newOwnerName}\r\n                            onChange={(e) => setNewOwnerName(e.target.value)}\r\n                            placeholder=\"Ej: María Pérez\"\r\n                            className=\"w-full bg-surface-highlight border border-border rounded-lg px-4 py-3 text-text-main focus:outline-none focus:ring-2 focus:ring-primary-500/50 transition-all placeholder:text-text-dim/50\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2\">\r\n                            PIN de Acceso (Numérico)\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newOwnerPin}\r\n                            onChange={(e) => setNewOwnerPin(e.target.value)}\r\n                            placeholder=\"Ej: 1234\"\r\n                            maxLength={8}\r\n                            className=\"w-full bg-surface-highlight border border-border rounded-lg px-4 py-3 text-text-main focus:outline-none focus:ring-2 focus:ring-primary-500/50 transition-all placeholder:text-text-dim/50 font-mono tracking-widest\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2\">\r\n                            Email (Usuario)\r\n                        </label>\r\n                        <input\r\n                            type=\"email\"\r\n                            value={newOwnerEmail}\r\n                            onChange={(e) => setNewOwnerEmail(e.target.value)}\r\n                            placeholder=\"dueño@ejemplo.com\"\r\n                            className=\"w-full bg-surface-highlight border border-border rounded-lg px-4 py-3 text-text-main focus:outline-none focus:ring-2 focus:ring-primary-500/50 transition-all placeholder:text-text-dim/50\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2\">\r\n                            Contraseña Inicial\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newOwnerPassword}\r\n                            onChange={(e) => setNewOwnerPassword(e.target.value)}\r\n                            placeholder=\"Mínimo 6 caracteres\"\r\n                            className=\"w-full bg-surface-highlight border border-border rounded-lg px-4 py-3 text-text-main focus:outline-none focus:ring-2 focus:ring-primary-500/50 transition-all placeholder:text-text-dim/50 font-mono\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex gap-3 mt-8\">\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={() => setIsCreating(false)}\r\n                    className=\"flex-1 px-4 py-3 rounded-xl border border-border text-text-muted font-bold hover:bg-surface-highlight hover:text-text-main transition-colors\"\r\n                    disabled={creatingLoading}\r\n                >\r\n                    Cancelar\r\n                </button>\r\n                <button\r\n                    type=\"submit\"\r\n                    className=\"flex-1 px-4 py-3 rounded-xl bg-primary-600 text-white font-bold hover:bg-primary-500 hover:shadow-lg transition-all shadow-primary-500/20 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                    disabled={creatingLoading}\r\n                >\r\n                    {creatingLoading ? <Loader2 size={18} className=\"animate-spin\" /> : null}\r\n                    {creatingLoading ? \"Creando...\" : \"Crear Tenant & Usuario\"}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* DELETE CONFIRMATION MODAL */}\r\n      {deleteModalOpen && tenantToDelete && (\r\n         <div className=\"fixed inset-0 z-[60] flex items-center justify-center p-4\">\r\n             <div className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\" onClick={() => !isDeleting && setDeleteModalOpen(false)} />\r\n             <div className=\"relative w-full max-w-md bg-surface border border-red-500/30 rounded-2xl shadow-2xl p-6 animate-in zoom-in-95 duration-200\">\r\n                <div className=\"flex items-center gap-4 mb-4\">\r\n                    <div className=\"p-3 rounded-full bg-red-500/10\">\r\n                        <AlertTriangle className=\"w-8 h-8 text-red-500\" />\r\n                    </div>\r\n                    <h3 className=\"text-xl font-bold text-text-main\">¿Eliminar Permanentemente?</h3>\r\n                </div>\r\n\r\n                <div className=\"space-y-4 mb-6\">\r\n                    <p className=\"text-text-muted leading-relaxed text-sm\">\r\n                        Estás a punto de eliminar el tenant <span className=\"font-bold text-text-main\">{tenantToDelete.name}</span>.\r\n                    </p>\r\n                    <div className=\"bg-red-500/5 border border-red-500/20 rounded-lg p-3 text-xs text-red-400 font-mono\">\r\n                        Se borrarán: Usuarios, Inventario, Servicios, Clientes, Gastos, Catálogos.\r\n                    </div>\r\n                    <p className=\"text-text-muted text-xs font-semibold\">\r\n                        ⚠️ Esta acción NO SE PUEDE DESHACER.\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"mb-6\">\r\n                    <label className=\"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2\">\r\n                        Escribe <span className=\"select-all text-text-main font-mono bg-black/20 px-1 rounded\">{tenantToDelete.id}</span> para confirmar:\r\n                    </label>\r\n                    <input \r\n                        type=\"text\" \r\n                        value={deleteConfirmationId}\r\n                        onChange={(e) => setDeleteConfirmationId(e.target.value)}\r\n                        placeholder={tenantToDelete.id}\r\n                        className=\"w-full bg-surface-highlight border border-border rounded-lg px-4 py-3 text-text-main focus:outline-none focus:ring-2 focus:ring-red-500/50 transition-all font-mono text-sm\"\r\n                        disabled={isDeleting}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"flex gap-3\">\r\n                    <button\r\n                        onClick={() => setDeleteModalOpen(false)}\r\n                        disabled={isDeleting}\r\n                        className=\"flex-1 px-4 py-3 rounded-xl border border-border text-text-muted font-bold hover:bg-surface-highlight hover:text-text-main transition-colors\"\r\n                    >\r\n                        Cancelar\r\n                    </button>\r\n                    <button\r\n                        onClick={confirmDelete}\r\n                        disabled={deleteConfirmationId !== tenantToDelete.id || isDeleting}\r\n                        className=\"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700 hover:shadow-lg transition-all shadow-red-500/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                    >\r\n                        {isDeleting ? <Loader2 size={18} className=\"animate-spin\" /> : <Trash2 size={18} />}\r\n                        {isDeleting ? \"Eliminando...\" : \"Eliminar Todo\"}\r\n                    </button>\r\n                </div>\r\n             </div>\r\n         </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MasterAdminScreen;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\OwnerScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\AnalyticsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\HistoryTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\InventoryAlerts.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\OwnerConfigTab.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\VS\\App_Principal\\src\\features\\admin\\components\\OwnerConfigTab.tsx:181:7\n  179 |   useEffect(() => {\n  180 |     if (initialTab && initialTab !== activeTab) {\n> 181 |       setActiveTab(initialTab);\n      |       ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  182 |     }\n  183 |   }, [initialTab]);\n  184 |","line":181,"column":7,"nodeType":null,"endLine":181,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeTab'. Either include it or remove the dependency array.","line":183,"column":6,"nodeType":"ArrayExpression","endLine":183,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, initialTab]","fix":{"range":[5355,5367],"text":"[activeTab, initialTab]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  ShoppingCart,\r\n  Users,\r\n  Menu,\r\n  X,\r\n  Database,\r\n} from \"lucide-react\";\r\nimport ConfirmationModal from \"../../../components/ui/ConfirmationModal\";\r\nimport {\r\n  collection,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  doc,\r\n  serverTimestamp,\r\n} from \"firebase/firestore\";\r\nimport { db } from \"../../../firebase\";\r\nimport type {\r\n  AppUser,\r\n  CatalogService,\r\n  CatalogExtra,\r\n  \r\n  \r\n  \r\n  Toast,\r\n  Service,\r\n  InventoryItem\r\n} from \"../../../types\";\r\n\r\n// Import Tab Manager Components\r\nimport { StaffManager } from \"./tabs/StaffManager\";\r\nimport { InventoryManager } from \"./tabs/InventoryManager\";\r\nimport { CatalogManager } from \"./tabs/CatalogManager\";\r\n\r\nexport type ConfigTab =\r\n  | \"catalog\"\r\n  | \"inventory\"\r\n  | \"personal\";\r\n\r\ninterface OwnerConfigTabProps {\r\n  users: AppUser[];\r\n  catalogServices: CatalogService[];\r\n  catalogExtras: CatalogExtra[];\r\n  \r\n  \r\n  currentUser: AppUser | null;\r\n  transactions?: Service[];\r\n  inventoryItems?: InventoryItem[]; // Unified items\r\n  showNotification: (message: string, type?: Toast[\"type\"]) => void;\r\n\r\n  // Optional controlled props\r\n  initialTab?: ConfigTab;\r\n  hideNavigation?: boolean;\r\n\r\n  // User Actions\r\n  createNewUser: (data: Omit<AppUser, \"id\">) => Promise<void>;\r\n  updateUser: (userId: string, data: Partial<AppUser>) => Promise<void>;\r\n  deleteUserPermanently: (userId: string) => Promise<void>;\r\n\r\n\r\n  // Inventory/Catalog Actions\r\n  addCatalogService: (\r\n    name: string,\r\n    price: number,\r\n    tenantId: string\r\n  ) => Promise<string>;\r\n  updateCatalogService: (\r\n    id: string,\r\n    data: Partial<CatalogService>,\r\n  ) => Promise<void>;\r\n  deleteCatalogService: (id: string) => Promise<void>;\r\n\r\n  addExtra: (name: string, price: number, tenantId: string) => Promise<string>;\r\n  updateExtra: (id: string, data: Partial<CatalogExtra>) => Promise<void>;\r\n  deleteExtra: (id: string) => Promise<void>;\r\n}\r\n\r\nconst OwnerConfigTab: React.FC<OwnerConfigTabProps> = ({\r\n  users,\r\n  catalogServices,\r\n  catalogExtras,\r\n  currentUser,\r\n  transactions = [],\r\n  showNotification,\r\n  initialTab,\r\n  hideNavigation = false,\r\n  createNewUser,\r\n  updateUser,\r\n  deleteUserPermanently,\r\n  addCatalogService,\r\n  updateCatalogService,\r\n  deleteCatalogService,\r\n  addExtra,\r\n  updateExtra,\r\n  deleteExtra,\r\n  inventoryItems = [], // Unified items\r\n}) => {\r\n  // ==========================================================================\r\n  // INVENTORY HANDLERS (Unified)\r\n  // ==========================================================================\r\n  \r\n  const handleAddInventory = async (product: Partial<InventoryItem>) => {\r\n    if (!currentUser?.tenantId) {\r\n      showNotification(\"Error: No se identificó la organización\", \"error\");\r\n      return;\r\n    }\r\n    try {\r\n      await addDoc(collection(db, \"inventory\"), {\r\n        ...product,\r\n        active: true,\r\n        tenantId: currentUser.tenantId,\r\n        createdAt: serverTimestamp(),\r\n      });\r\n      showNotification(\"Producto agregado al inventario\");\r\n    } catch (error) {\r\n      console.error(\"Error adding inventory:\", error);\r\n      showNotification(\"Error al agregar producto\", \"error\");\r\n    }\r\n  };\r\n\r\n  const handleUpdateInventory = async (id: string, updates: Partial<InventoryItem>) => {\r\n    try {\r\n      await updateDoc(doc(db, \"inventory\", id), updates);\r\n      showNotification(\"Producto actualizado\");\r\n    } catch (error) {\r\n      console.error(\"Error updating inventory:\", error);\r\n      showNotification(\"Error al actualizar producto\", \"error\");\r\n    }\r\n  };\r\n\r\n  // Confirmation Modal State\r\n  const [confirmConfig, setConfirmConfig] = useState<{\r\n    isOpen: boolean;\r\n    title: string;\r\n    message: string;\r\n    onConfirm: () => void;\r\n    isLoading?: boolean;\r\n  }>({\r\n    isOpen: false,\r\n    title: \"\",\r\n    message: \"\",\r\n    onConfirm: () => {},\r\n    isLoading: false,\r\n  });\r\n\r\n  const closeConfirmation = () =>\r\n    setConfirmConfig((prev) => ({ ...prev, isOpen: false }));\r\n\r\n  const handleDeleteInventory = (id: string) => {\r\n    setConfirmConfig({\r\n      isOpen: true,\r\n      title: \"Eliminar Producto\",\r\n      message:\r\n        \"¿Estás seguro de que deseas eliminar este producto del inventario? Esta acción no se puede deshacer.\",\r\n      isLoading: false,\r\n      onConfirm: async () => {\r\n        setConfirmConfig((prev) => ({ ...prev, isLoading: true }));\r\n        try {\r\n          await deleteDoc(doc(db, \"inventory\", id));\r\n          showNotification(\"Producto eliminado\");\r\n          closeConfirmation();\r\n        } catch (error) {\r\n          console.error(\"Error deleting inventory:\", error);\r\n          showNotification(\"Error al eliminar producto\", \"error\");\r\n          setConfirmConfig((prev) => ({ ...prev, isLoading: false }));\r\n        }\r\n      },\r\n    });\r\n  };\r\n  // ==========================================================================\r\n  // STATE MANAGEMENT (Navigation Only)\r\n  // ==========================================================================\r\n\r\n  const [activeTab, setActiveTab] = useState<ConfigTab>(initialTab || \"catalog\");\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n\r\n  // Sync internal state with external prop changes (Sidebar navigation)\r\n  useEffect(() => {\r\n    if (initialTab && initialTab !== activeTab) {\r\n      setActiveTab(initialTab);\r\n    }\r\n  }, [initialTab]);\r\n\r\n  // ==========================================================================\r\n  // TAB CONFIGURATION\r\n  // ==========================================================================\r\n\r\n  const tabs: {\r\n    id: ConfigTab;\r\n    label: string;\r\n    icon: React.ElementType;\r\n    description: string;\r\n  }[] = [\r\n    {\r\n      id: \"catalog\",\r\n      label: \"Catálogo\",\r\n      icon: ShoppingCart,\r\n      description: \"Servicios y Extras\",\r\n    },\r\n    {\r\n      id: \"inventory\", // Unified tab\r\n      label: \"Inventario\",\r\n      icon: Database,\r\n      description: \"Gestión unificada de stock\",\r\n    },\r\n    {\r\n      id: \"personal\",\r\n      label: \"Personal\",\r\n      icon: Users,\r\n      description: \"Gestión de empleados\",\r\n    },\r\n  ];\r\n\r\n  // ==========================================================================\r\n  // EVENT HANDLERS\r\n  // ==========================================================================\r\n\r\n  const handleTabChange = (tab: ConfigTab) => {\r\n    setActiveTab(tab);\r\n    setIsMobileMenuOpen(false);\r\n  };\r\n\r\n  // ==========================================================================\r\n  // RENDER\r\n  // ==========================================================================\r\n\r\n  return (\r\n    <div className=\"flex h-[calc(100vh-theme(spacing.20))] bg-background\">\r\n      {/* Sidebar Navigation */}\r\n      {!hideNavigation && (\r\n        <>\r\n          {/* Mobile Menu Button */}\r\n          <button\r\n            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\r\n            className=\"lg:hidden fixed top-24 left-4 z-50 p-3 bg-surface rounded-xl border border-border shadow-lg\"\r\n          >\r\n            {isMobileMenuOpen ? <X size={20} /> : <Menu size={20} />}\r\n          </button>\r\n\r\n          {/* Sidebar */}\r\n          <aside\r\n            className={\"fixed lg:sticky top-0 left-0 h-full w-64 bg-surface border-r border-border transition-transform duration-300 ease-in-out z-40 lg:block overflow-y-auto \" + (isMobileMenuOpen ? \"translate-x-0\" : \"-translate-x-full lg:translate-x-0\")}\r\n          >\r\n            <div className=\"p-6 space-y-2\">\r\n              <h2 className=\"text-lg font-bold text-text-main mb-4 px-3\">\r\n                Configuración\r\n              </h2>\r\n\r\n              {tabs.map((tab) => {\r\n                const Icon = tab.icon;\r\n                const isActive = activeTab === tab.id;\r\n\r\n                return (\r\n                  <button\r\n                    key={tab.id}\r\n                    onClick={() => handleTabChange(tab.id)}\r\n                    className={`w-full p-3 rounded-xl text-left transition-all duration-200 group ${\r\n                      isActive\r\n                        ? \"bg-primary-600 text-white shadow-lg shadow-primary-600/20\"\r\n                        : \"hover:bg-surface-highlight text-text-muted hover:text-text-main\"\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Icon\r\n                        size={20}\r\n                        className={\r\n                          isActive\r\n                            ? \"text-white\"\r\n                            : \"text-text-muted group-hover:text-primary-600\"\r\n                        }\r\n                      />\r\n                      <div>\r\n                        <p\r\n                          className={`font-semibold ${isActive ? \"text-white\" : \"\"}`}\r\n                        >\r\n                          {tab.label}\r\n                        </p>\r\n                        <p\r\n                          className={`text-xs ${isActive ? \"text-primary-100\" : \"text-text-muted\"}`}\r\n                        >\r\n                          {tab.description}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </aside>\r\n\r\n          {/* Mobile Overlay */}\r\n          {isMobileMenuOpen && (\r\n            <div\r\n              className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-30 lg:hidden\"\r\n              onClick={() => setIsMobileMenuOpen(false)}\r\n            />\r\n          )}\r\n        </>\r\n      )}\r\n\r\n      {/* Main Content Area */}\r\n      <div className=\"flex-1 overflow-hidden bg-background relative\">\r\n        <div className=\"h-full overflow-y-auto p-4 lg:p-8 scrollbar-hide\">\r\n          <div className=\"w-full max-w-full space-y-6\">\r\n            \r\n            {/* Catalog Tab */}\r\n            {activeTab === \"catalog\" && (\r\n              <CatalogManager\r\n                // Services props\r\n                catalogServices={catalogServices}\r\n                inventoryItems={inventoryItems}\r\n                addCatalogService={async (name, price) => {\r\n                  if (!currentUser?.tenantId) {\r\n                    throw new Error(\"No se puede crear un servicio sin tenantId válido\");\r\n                  }\r\n                  return addCatalogService(name, price, currentUser.tenantId);\r\n                }}\r\n                updateCatalogService={updateCatalogService}\r\n                deleteCatalogService={deleteCatalogService}\r\n                // Extras props\r\n                catalogExtras={catalogExtras}\r\n                addExtra={async (name, price) => {\r\n                  if (!currentUser?.tenantId) {\r\n                    throw new Error(\"No se puede crear un extra sin tenantId válido\");\r\n                  }\r\n                  return addExtra(name, price, currentUser.tenantId);\r\n                }}\r\n                updateExtra={updateExtra}\r\n                deleteExtra={deleteExtra}\r\n                // Shared props\r\n                currentUser={currentUser}\r\n                showNotification={showNotification}\r\n              />\r\n            )}\r\n\r\n            {/* Inventory Unified Tab */}\r\n            {activeTab === \"inventory\" && (\r\n              <InventoryManager\r\n                inventoryItems={inventoryItems}\r\n                currentUser={currentUser}\r\n                showNotification={showNotification}\r\n                onAdd={handleAddInventory}\r\n                onUpdate={handleUpdateInventory}\r\n                onDelete={handleDeleteInventory}\r\n                onEdit={() => {}} // Handled internally by InventoryManager for now\r\n              />\r\n            )}\r\n\r\n            {/* Personal/Staff Tab */}\r\n            {activeTab === \"personal\" && (\r\n              <StaffManager\r\n                users={users}\r\n                currentUser={currentUser}\r\n                transactions={transactions}\r\n                createNewUser={createNewUser}\r\n                updateUser={updateUser}\r\n                deleteUserPermanently={deleteUserPermanently}\r\n                showNotification={showNotification}\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <ConfirmationModal\r\n        isOpen={confirmConfig.isOpen}\r\n        onClose={closeConfirmation}\r\n        onConfirm={confirmConfig.onConfirm}\r\n        title={confirmConfig.title}\r\n        message={confirmConfig.message}\r\n        isLoading={confirmConfig.isLoading}\r\n      />\r\n      \r\n      \r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OwnerConfigTab;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\OwnerDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\StaffDetailView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\CatalogManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\ClientsManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\ExtrasManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Save' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":7},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\ExtrasManager.tsx:113:7\n  111 |   useEffect(() => {\n  112 |     if (editingExtraItem) {\n> 113 |       setExtraFormTab(\"info\");\n      |       ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  114 |     }\n  115 |   }, [editingExtraItem]);\n  116 |","line":113,"column":7,"nodeType":null,"endLine":113,"endColumn":22},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\ExtrasManager.tsx:119:5\n  117 |   // Pagination Link Reset Logic\n  118 |   useEffect(() => {\n> 119 |     setExtrasPage(1);\n      |     ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  120 |   }, [catalogExtras.length]);\n  121 |\n  122 |   // ==========================================================================","line":119,"column":5,"nodeType":null,"endLine":119,"endColumn":18}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect } from \"react\";\r\nimport {\r\n  Plus,\r\n  X,\r\n  Edit2,\r\n  Trash2,\r\n  CheckCircle,\r\n  XCircle,\r\n  Save,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  DollarSign,\r\n  Beaker,\r\n  AlertTriangle,\r\n  Package,\r\n} from \"lucide-react\";\r\nimport ConfirmationModal from \"../../../../components/ui/ConfirmationModal\";\r\nimport type { CatalogExtra, Toast, AppUser, InventoryItem } from \"../../../../types\";\r\n\r\n// ============================================================================\r\n// INTERFACES\r\n// ============================================================================\r\n\r\nexport interface ExtrasManagerProps {\r\n  // Data\r\n  catalogExtras: CatalogExtra[];\r\n  inventoryItems?: InventoryItem[];\r\n  currentUser: AppUser | null;\r\n\r\n  // Actions\r\n  addExtra: (name: string, price: number) => Promise<string>;\r\n  updateExtra: (id: string, updates: Partial<CatalogExtra>) => Promise<void>;\r\n  deleteExtra: (id: string) => Promise<void>;\r\n  showNotification: (message: string, type?: Toast[\"type\"]) => void;\r\n}\r\n\r\n// ============================================================================\r\n// EMPTY STATE COMPONENT\r\n// ============================================================================\r\n\r\nconst EmptyState = ({\r\n  icon: Icon,\r\n  title,\r\n  message,\r\n}: {\r\n  icon: React.ElementType;\r\n  title: string;\r\n  message: string;\r\n}) => (\r\n  <div className=\"flex flex-col items-center justify-center py-12 text-center animate-fade-in\">\r\n    <Icon size={64} className=\"text-gray-700/50 mb-4\" strokeWidth={1.5} />\r\n    <h3 className=\"text-sm font-bold text-text-main mb-2\">{title}</h3>\r\n    <p className=\"text-sm text-text-muted max-w-xs mx-auto\">{message}</p>\r\n  </div>\r\n);\r\n\r\n// ============================================================================\r\n// MAIN COMPONENT\r\n// ============================================================================\r\n\r\nexport const ExtrasManager: React.FC<ExtrasManagerProps> = ({\r\n  catalogExtras,\r\n  inventoryItems = [],\r\n  currentUser,\r\n  addExtra,\r\n  updateExtra,\r\n  deleteExtra,\r\n  showNotification,\r\n}) => {\r\n  // ==========================================================================\r\n  // STATE MANAGEMENT\r\n  // ==========================================================================\r\n\r\n  // Edit Extra State (Slide-over)\r\n  const [editingExtraItem, setEditingExtraItem] = useState<CatalogExtra | null>(\r\n    null,\r\n  );\r\n  const [editExtraForm, setEditExtraForm] = useState<Partial<CatalogExtra>>({});\r\n  const [selectedMaterials, setSelectedMaterials] = useState<\r\n    { materialId: string; qty: number }[]\r\n  >([]);\r\n\r\n  // Search States for Extra Editor\r\n  const [materialSearch, setMaterialSearch] = useState(\"\");\r\n  const [isMaterialDropdownOpen, setIsMaterialDropdownOpen] = useState(false);\r\n  const materialDropdownRef = React.useRef<HTMLDivElement>(null);\r\n\r\n  React.useEffect(() => {\r\n    function handleClickOutside(event: MouseEvent) {\r\n      if (\r\n        materialDropdownRef.current &&\r\n        !materialDropdownRef.current.contains(event.target as Node)\r\n      ) {\r\n        setIsMaterialDropdownOpen(false);\r\n      }\r\n    }\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  // Extra Form Tabs\r\n  const [extraFormTab, setExtraFormTab] = useState<\r\n    \"info\" | \"materials\"\r\n  >(\"info\");\r\n\r\n  // Pagination\r\n  const ITEMS_PER_PAGE = 7;\r\n  const [extrasPage, setExtrasPage] = useState(1);\r\n\r\n  // Reset tab when opening an extra\r\n  useEffect(() => {\r\n    if (editingExtraItem) {\r\n      setExtraFormTab(\"info\");\r\n    }\r\n  }, [editingExtraItem]);\r\n\r\n  // Pagination Link Reset Logic\r\n  useEffect(() => {\r\n    setExtrasPage(1);\r\n  }, [catalogExtras.length]);\r\n\r\n  // ==========================================================================\r\n  // COMPUTED VALUES\r\n  // ==========================================================================\r\n\r\n  const paginatedExtras = useMemo(() => {\r\n    return catalogExtras.slice(\r\n      (extrasPage - 1) * ITEMS_PER_PAGE,\r\n      extrasPage * ITEMS_PER_PAGE,\r\n    );\r\n  }, [catalogExtras, extrasPage]);\r\n\r\n  const totalPages = Math.ceil(catalogExtras.length / ITEMS_PER_PAGE);\r\n\r\n  // Unified Material List for Search\r\n  const allMaterials = useMemo(() => {\r\n    if (inventoryItems && inventoryItems.length > 0) {\r\n      return inventoryItems.map((item) => {\r\n        const calculatedUnitCost =\r\n          item.unitCost ||\r\n          (item.purchasePrice && item.content\r\n            ? item.purchasePrice / item.content\r\n            : 0);\r\n\r\n        return {\r\n          id: item.id,\r\n          name: item.name,\r\n          type: \"material\" as const,\r\n          unit: item.unit,\r\n          cost: calculatedUnitCost,\r\n          _originalType: item.type,\r\n        };\r\n      }).sort((a, b) => a.name.localeCompare(b.name));\r\n    }\r\n    return [];\r\n  }, [inventoryItems]);\r\n\r\n  // Unified Selected Items for Display\r\n  const allSelectedItems = useMemo(() => {\r\n    const findItemDetails = (id: string) => {\r\n      const invItem = inventoryItems.find(\r\n        (i) => i.id === id || i.originalId === id,\r\n      );\r\n      if (invItem) {\r\n        const calculatedUnitCost =\r\n          invItem.unitCost ||\r\n          (invItem.purchasePrice && invItem.content\r\n            ? invItem.purchasePrice / invItem.content\r\n            : 0);\r\n        return {\r\n          name: invItem.name,\r\n          unit: invItem.unit,\r\n          cost: calculatedUnitCost,\r\n        };\r\n      }\r\n\r\n      return {\r\n        name: \"Desconocido\",\r\n        unit: \"uds\",\r\n        cost: 0,\r\n      };\r\n    };\r\n\r\n    return selectedMaterials.map((s) => {\r\n      const details = findItemDetails(s.materialId);\r\n      return {\r\n        id: s.materialId,\r\n        qty: s.qty,\r\n        name: details.name,\r\n        type: \"material\" as const,\r\n        unit: details.unit,\r\n        cost: details.cost * s.qty,\r\n        unitCost: details.cost,\r\n      };\r\n    });\r\n  }, [selectedMaterials, inventoryItems]);\r\n\r\n  const totalEstimatedMaterialCost = useMemo(() => {\r\n    const total = allSelectedItems.reduce(\r\n      (sum, item) => sum + (item.cost || 0),\r\n      0,\r\n    );\r\n    return { total };\r\n  }, [allSelectedItems]);\r\n\r\n  // ==========================================================================\r\n  // EVENT HANDLERS\r\n  // ==========================================================================\r\n\r\n  const handleSaveUnifiedExtra = async () => {\r\n    if (!editingExtraItem) return;\r\n\r\n    try {\r\n      const name = (editExtraForm.name || \"\").trim();\r\n      if (!name) {\r\n        showNotification(\"El nombre del extra es obligatorio\", \"error\");\r\n        return;\r\n      }\r\n\r\n      const duplicate = catalogExtras.find(\r\n        (s) =>\r\n          s.name.trim().toLowerCase() === name.toLowerCase() &&\r\n          s.id !== editingExtraItem.id &&\r\n          s.id !== \"new\"\r\n      );\r\n\r\n      if (duplicate) {\r\n        showNotification(\"Ya existe un extra con este nombre\", \"error\");\r\n        return;\r\n      }\r\n\r\n      const price = Number(editExtraForm.price) || 0;\r\n      if (price < 0) {\r\n        showNotification(\"El precio debe ser 0 o mayor\", \"error\");\r\n        return;\r\n      }\r\n\r\n      if (editingExtraItem.id === \"new\") {\r\n        const newId = await addExtra(name, price);\r\n\r\n        if (selectedMaterials.length > 0) {\r\n          await updateExtra(newId, {\r\n            manualMaterials: selectedMaterials,\r\n          });\r\n        }\r\n\r\n        showNotification(\"Extra agregado exitosamente\");\r\n      } else {\r\n        await updateExtra(editingExtraItem.id, {\r\n          ...editExtraForm,\r\n          name,\r\n          price,\r\n          manualMaterials: selectedMaterials,\r\n        });\r\n        showNotification(\"Extra actualizado exitosamente\");\r\n      }\r\n      setEditingExtraItem(null);\r\n    } catch (error) {\r\n      console.error(\"Error guardando extra:\", error);\r\n      const message =\r\n        error instanceof Error ? error.message : \"Error al guardar\";\r\n      showNotification(message, \"error\");\r\n    }\r\n  };\r\n\r\n  const handleToggleExtraStatus = async (id: string, active: boolean) => {\r\n    try {\r\n      await updateExtra(id, { active: !active });\r\n      showNotification(active ? \"Extra desactivado\" : \"Extra activado\");\r\n    } catch (error) {\r\n      console.error(\"Error actualizando extra:\", error);\r\n      showNotification(\"Error al actualizar\", \"error\");\r\n    }\r\n  };\r\n\r\n  const [confirmConfig, setConfirmConfig] = useState<{\r\n    isOpen: boolean;\r\n    title: string;\r\n    message: string;\r\n    onConfirm: () => void;\r\n    isLoading?: boolean;\r\n  }>({\r\n    isOpen: false,\r\n    title: \"\",\r\n    message: \"\",\r\n    onConfirm: () => {},\r\n    isLoading: false,\r\n  });\r\n\r\n  const closeConfirmation = () =>\r\n    setConfirmConfig((prev) => ({ ...prev, isOpen: false }));\r\n\r\n  const handleDeleteExtra = (id: string) => {\r\n    setConfirmConfig({\r\n      isOpen: true,\r\n      title: \"Eliminar Extra\",\r\n      message:\r\n        \"¿Estás seguro de que deseas eliminar este servicio extra? Esta acción no se puede deshacer.\",\r\n      isLoading: false,\r\n      onConfirm: async () => {\r\n        setConfirmConfig((prev) => ({ ...prev, isLoading: true }));\r\n        try {\r\n          await deleteExtra(id);\r\n          showNotification(\"Extra eliminado\");\r\n          closeConfirmation();\r\n        } catch (error) {\r\n          console.error(\"Error eliminando extra:\", error);\r\n          showNotification(\"Error al eliminar\", \"error\");\r\n          setConfirmConfig((prev) => ({ ...prev, isLoading: false }));\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  const handleAddMaterial = (materialId: string) => {\r\n    setSelectedMaterials((prev) => {\r\n      const exists = prev.some((m) => m.materialId === materialId);\r\n      if (exists) return prev; // Do nothing if already exists\r\n      return [...prev, { materialId, qty: 0 }];\r\n    });\r\n  };\r\n\r\n  const handleRemoveMaterial = (materialId: string) => {\r\n    setSelectedMaterials((prev) =>\r\n      prev.filter((m) => m.materialId !== materialId)\r\n    );\r\n  };\r\n\r\n  const handleMaterialQtyChange = (materialId: string, qty: number) => {\r\n    setSelectedMaterials((prev) =>\r\n      prev.map((m) =>\r\n        m.materialId === materialId ? { ...m, qty: Math.max(0, qty) } : m,\r\n      ),\r\n    );\r\n  };\r\n\r\n  // ==========================================================================\r\n  // RENDER\r\n  // ==========================================================================\r\n\r\n  return (\r\n    <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n      {/* Header & Add Button */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h3 className=\"text-2xl font-bold text-text-main flex items-center gap-2\">\r\n          <Plus className=\"text-primary-600\" />\r\n          Extras Adicionales\r\n        </h3>\r\n        <button\r\n          onClick={() => {\r\n            setEditingExtraItem({\r\n              id: \"new\",\r\n              name: \"\",\r\n              price: 0,\r\n              active: true,\r\n              tenantId: \"\",\r\n              createdAt: new Date().toISOString(),\r\n            } as unknown as CatalogExtra);\r\n            setEditExtraForm({ price: 0 });\r\n            setSelectedMaterials([]);\r\n            setMaterialSearch(\"\");\r\n          }}\r\n          className=\"bg-primary-600 hover:bg-primary-600/80 text-white font-bold p-2 md:px-4 md:py-2 rounded-xl shadow-lg shadow-primary-600/20 hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200 ease-out flex items-center gap-2 active:scale-95 w-auto\"\r\n        >\r\n          <Plus size={18} />\r\n          <span className=\"hidden md:inline-block ml-1\">Nuevo Extra</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Extras Table */}\r\n      <div className=\"bg-surface rounded-xl border border-border overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"bg-surface-highlight\">\r\n              <tr>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                  Nombre\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                  Precio\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                  Costo Material\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                  Estado\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-text-muted uppercase tracking-wider\">\r\n                  Acciones\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody className=\"divide-y divide-border\">\r\n              {paginatedExtras.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={5}>\r\n                    <EmptyState\r\n                      icon={Plus}\r\n                      title=\"No hay extras\"\r\n                      message=\"Crea el primer extra usando el botón superior.\"\r\n                    />\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                paginatedExtras.map((extra) => {\r\n                  const getRefCost = (id: string) => {\r\n                    const invItem = inventoryItems.find(\r\n                      (i) => i.id === id || i.originalId === id,\r\n                    );\r\n                    if (invItem) {\r\n                      return (\r\n                        invItem.unitCost ||\r\n                        (invItem.purchasePrice && invItem.content\r\n                          ? invItem.purchasePrice / invItem.content\r\n                          : 0)\r\n                      );\r\n                    }\r\n                    return 0;\r\n                  };\r\n\r\n                  const materialsCost = (extra.manualMaterials || []).reduce(\r\n                    (sum, m) => sum + getRefCost(m.materialId) * m.qty,\r\n                    0,\r\n                  );\r\n\r\n                  return (\r\n                    <tr\r\n                      key={extra.id}\r\n                      className={`group transition-colors duration-200 hover:bg-surface-highlight ${\r\n                        !extra.active ? \"opacity-60 bg-surface-highlight\" : \"\"\r\n                      }`}\r\n                    >\r\n                      {/* Name */}\r\n                      <td className=\"px-6 py-4 text-sm font-medium text-text-main min-w-[200px]\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {extra.name}\r\n                          {(extra.manualMaterials?.length ?? 0) > 0 ? (\r\n                            <div\r\n                              title=\"Configurado con Materiales\"\r\n                              className=\"text-emerald-500 bg-emerald-500/10 p-1 rounded-full\"\r\n                            >\r\n                              <Beaker size={14} />\r\n                            </div>\r\n                          ) : (\r\n                            <div\r\n                              title=\"Sin receta de materiales\"\r\n                              className=\"text-orange-400 bg-orange-500/10 p-1 rounded-full\"\r\n                            >\r\n                              <AlertTriangle size={14} />\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </td>\r\n\r\n                      {/* Price */}\r\n                      <td className=\"px-6 py-4\">\r\n                        <p className=\"font-bold text-primary-600\">\r\n                          ${(extra.price || 0).toFixed(2)}\r\n                        </p>\r\n                      </td>\r\n\r\n                      {/* Cost */}\r\n                      <td className=\"px-6 py-4 min-w-[120px]\">\r\n                        {materialsCost > 0 ? (\r\n                          <div\r\n                            className=\"flex flex-col\"\r\n                            title={`Costo Materiales: $${materialsCost.toFixed(2)}`}\r\n                          >\r\n                            <span className=\"text-sm font-bold text-text-muted\">\r\n                              ${materialsCost.toFixed(2)}\r\n                            </span>\r\n                          </div>\r\n                        ) : (\r\n                          <span className=\"text-gray-400\">-</span>\r\n                        )}\r\n                      </td>\r\n\r\n                      {/* Status */}\r\n                      <td className=\"px-6 py-4\">\r\n                        <span\r\n                          className={`inline-flex items-center px-3 py-1 rounded-full text-[11px] uppercase tracking-wider font-bold shadow-sm ${\r\n                            extra.active\r\n                              ? \"bg-primary-600/10 text-primary-600 ring-1 ring-primary-600/20\"\r\n                              : \"bg-primary-700/10 text-primary-700 ring-1 ring-primary-700/20\"\r\n                          }`}\r\n                        >\r\n                          {extra.active ? \"Activo\" : \"Inactivo\"}\r\n                        </span>\r\n                      </td>\r\n\r\n                      {/* Actions */}\r\n                      <td className=\"px-6 py-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <button\r\n                            onClick={() => {\r\n                              setEditingExtraItem(extra);\r\n                              setEditExtraForm(extra);\r\n                              setMaterialSearch(\"\");\r\n\r\n                              if (\r\n                                extra.manualMaterials &&\r\n                                extra.manualMaterials.length > 0\r\n                              ) {\r\n                                setSelectedMaterials(extra.manualMaterials);\r\n                              } else {\r\n                                setSelectedMaterials([]);\r\n                              }\r\n                            }}\r\n                            className=\"p-2 rounded-lg text-primary-500 hover:bg-primary-500/10 transition-all duration-200 hover:scale-110 active:scale-90\"\r\n                            title=\"Editar\"\r\n                          >\r\n                            <Edit2 size={16} />\r\n                          </button>\r\n                          \r\n                          <button\r\n                            onClick={() =>\r\n                              handleToggleExtraStatus(extra.id, extra.active !== false)\r\n                            }\r\n                            className={`p-2 rounded-lg text-primary-700 hover:bg-primary-700/10 transition-all duration-200 hover:scale-110 active:scale-90`}\r\n                            title={extra.active ? \"Desactivar\" : \"Activar\"}\r\n                          >\r\n                            {extra.active !== false ? (\r\n                              <XCircle size={16} />\r\n                            ) : (\r\n                              <CheckCircle size={16} />\r\n                            )}\r\n                          </button>\r\n\r\n                          {currentUser?.role === \"owner\" && (\r\n                            <button\r\n                              onClick={() => handleDeleteExtra(extra.id)}\r\n                              className=\"p-2 rounded-lg text-primary-700 hover:bg-primary-700/10 transition-all duration-200 hover:scale-110 active:scale-90\"\r\n                              title=\"Eliminar\"\r\n                            >\r\n                              <Trash2 size={16} />\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Pagination */}\r\n        {totalPages > 1 && (\r\n          <div className=\"flex justify-between items-center px-4 py-3 border-t border-border mt-2 bg-surface-highlight\">\r\n            <p className=\"text-sm text-text-muted font-medium\">\r\n              Página {extrasPage} de {totalPages}\r\n            </p>\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={() => setExtrasPage((p) => Math.max(1, p - 1))}\r\n                disabled={extrasPage === 1}\r\n                className=\"px-3 py-2 rounded-lg border border-border text-gray-400 hover:bg-surface-highlight disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm\"\r\n              >\r\n                <ChevronLeft size={18} />\r\n              </button>\r\n              <button\r\n                onClick={() => setExtrasPage((p) => Math.min(totalPages, p + 1))}\r\n                disabled={extrasPage === totalPages}\r\n                className=\"px-3 py-2 rounded-lg border border-border text-gray-400 hover:bg-surface-highlight disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm\"\r\n              >\r\n                <ChevronRight size={18} />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Edit Extra Slide-over Panel */}\r\n      {editingExtraItem && (\r\n        <div className=\"fixed inset-0 z-50 flex justify-end\">\r\n          {/* Backdrop */}\r\n          <div\r\n            className=\"absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity\"\r\n            onClick={() => setEditingExtraItem(null)}\r\n          />\r\n\r\n          {/* Panel */}\r\n          <div className=\"relative w-full max-w-2xl bg-surface h-full shadow-2xl border-l border-border flex flex-col animate-in slide-in-from-right duration-300\">\r\n            {/* Header */}\r\n            <div className=\"px-6 py-4 bg-surface-highlight border-b border-border flex justify-between items-center\">\r\n              <div>\r\n                <h3 className=\"text-xl font-bold text-text-main\">\r\n                  {editingExtraItem.id === \"new\"\r\n                    ? \"Nuevo Extra\"\r\n                    : \"Editar Extra\"}\r\n                </h3>\r\n                <p className=\"text-sm text-text-muted\">\r\n                  {editingExtraItem.id === \"new\"\r\n                    ? \"Crear servicio extra adicional\"\r\n                    : \"Modificar extra existente\"}\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={() => setEditingExtraItem(null)}\r\n                className=\"p-2 rounded-full hover:bg-surface-highlight text-text-muted transition-all duration-300 hover:rotate-90 active:scale-90\"\r\n              >\r\n                <X size={20} />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex w-full max-w-full overflow-x-auto no-scrollbar gap-2 px-2 pb-2 items-center justify-start md:justify-center bg-surface border-b border-border\">\r\n              <button\r\n                onClick={() => setExtraFormTab(\"info\")}\r\n                className={`px-3 py-2 whitespace-nowrap rounded-lg font-medium text-sm transition-all ${\r\n                  extraFormTab === \"info\"\r\n                    ? \"bg-primary-600 text-white shadow-lg shadow-primary-600/20\"\r\n                    : \"text-text-muted hover:bg-surface-highlight\"\r\n                }`}\r\n              >\r\n                Información\r\n              </button>\r\n              <button\r\n                onClick={() => setExtraFormTab(\"materials\")}\r\n                className={`px-3 py-2 whitespace-nowrap rounded-lg font-medium text-sm transition-all flex items-center gap-2 ${\r\n                  extraFormTab === \"materials\"\r\n                    ? \"bg-primary-600 text-white shadow-lg shadow-primary-600/20\"\r\n                    : \"text-text-muted hover:bg-surface-highlight\"\r\n                }`}\r\n              >\r\n                <Beaker size={16} />\r\n                Materiales\r\n                {allSelectedItems.length > 0 && (\r\n                  <span className=\"px-1.5 py-0.5 bg-white/20 rounded-full text-xs font-bold\">\r\n                    {allSelectedItems.length}\r\n                  </span>\r\n                )}\r\n              </button>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\r\n              {/* Tab: INFO */}\r\n              {extraFormTab === \"info\" && (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-text-muted\">\r\n                      Nombre del Extra\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      placeholder=\"ej. Diseño de Uñas\"\r\n                      value={editExtraForm.name || \"\"}\r\n                      onChange={(e) =>\r\n                        setEditExtraForm((prev) => ({\r\n                          ...prev,\r\n                          name: e.target.value,\r\n                        }))\r\n                      }\r\n                      className=\"w-full px-4 py-2 bg-surface text-text-main border border-border rounded-lg transition-all duration-200 focus:ring-4 focus:ring-primary-500/20 focus:border-primary-500 outline-none\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-text-muted\">\r\n                      Precio Adicional\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <DollarSign\r\n                        size={18}\r\n                        className=\"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted\"\r\n                      />\r\n                      <input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        placeholder=\"0.00\"\r\n                        value={editExtraForm.price ?? \"\"}\r\n                        onChange={(e) => {\r\n                          const val = e.target.value;\r\n                          setEditExtraForm((prev) => ({\r\n                            ...prev,\r\n                            price: val === \"\" ? 0 : parseFloat(val),\r\n                          }));\r\n                        }}\r\n                        className=\"w-full pl-10 pr-4 py-2 bg-surface text-text-main border border-border rounded-lg transition-all duration-200 focus:ring-4 focus:ring-primary-500/20 focus:border-primary-500 outline-none font-semibold\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Cost Summary */}\r\n                  <div className=\"p-4 bg-primary-600/10 rounded-xl border border-primary-600/20 space-y-2\">\r\n                    <h4 className=\"font-bold text-text-main text-sm\">\r\n                      Resumen de Costos\r\n                    </h4>\r\n                    <div className=\"grid grid-cols-1 gap-2 text-sm\">\r\n                      <div className=\"pt-2\">\r\n                        <span className=\"text-text-muted\">\r\n                          Costo Total Materiales:\r\n                        </span>\r\n                        <span className=\"float-right font-bold text-primary-600 text-lg\">\r\n                          ${totalEstimatedMaterialCost.total.toFixed(2)}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Status Toggle */}\r\n                  <div className=\"flex items-center justify-between p-4 bg-surface-highlight rounded-xl border border-border\">\r\n                    <div>\r\n                      <span className=\"block font-semibold text-text-main\">\r\n                        Estado del Extra\r\n                      </span>\r\n                      <span className=\"text-xs text-text-muted\">\r\n                        Visible al crear nueva venta\r\n                      </span>\r\n                    </div>\r\n                    <button\r\n                      onClick={() =>\r\n                        setEditExtraForm((prev) => ({\r\n                          ...prev,\r\n                          active: !prev.active,\r\n                        }))\r\n                      }\r\n                      className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\r\n                        editExtraForm.active !== false\r\n                          ? \"bg-primary-600\"\r\n                          : \"bg-primary-700/50\"\r\n                      }`}\r\n                    >\r\n                      <span\r\n                        className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\r\n                          editExtraForm.active !== false\r\n                            ? \"translate-x-6\"\r\n                            : \"translate-x-1\"\r\n                        }`}\r\n                      />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Tab: MATERIALS */}\r\n              {extraFormTab === \"materials\" && (\r\n                <div className=\"space-y-6\">\r\n                  {/* Search Interface */}\r\n                  <div className=\"space-y-2 relative\" ref={materialDropdownRef}>\r\n                    <label className=\"text-sm font-medium text-text-muted\">\r\n                      Buscar Material\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <input\r\n                        type=\"text\"\r\n                        placeholder=\"Buscar material...\"\r\n                        value={materialSearch}\r\n                        onFocus={() => setIsMaterialDropdownOpen(true)}\r\n                        onChange={(e) => {\r\n                          setMaterialSearch(e.target.value);\r\n                          setIsMaterialDropdownOpen(true);\r\n                        }}\r\n                        className=\"w-full pl-10 pr-4 py-3 bg-surface text-text-main border border-border rounded-xl transition-all duration-200 focus:ring-4 focus:ring-primary-500/20 focus:border-primary-500 outline-none shadow-sm\"\r\n                      />\r\n                      <div className=\"absolute left-3 top-3.5 text-gray-400\">\r\n                        <Plus size={18} />\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Dropdown Results */}\r\n                    {isMaterialDropdownOpen && (\r\n                      <div className=\"absolute z-10 w-full mt-1 bg-surface border border-border rounded-xl shadow-xl max-h-48 overflow-y-auto animate-in fade-in zoom-in-95 duration-200\">\r\n                        {allMaterials\r\n                          .filter((m) =>\r\n                            m.name\r\n                              .toLowerCase()\r\n                              .includes(materialSearch.toLowerCase()),\r\n                          )\r\n                          .map((material) => {\r\n                            const isSelected = selectedMaterials.some(\r\n                              (m) => m.materialId === material.id,\r\n                            );\r\n\r\n                            return (\r\n                              <button\r\n                                key={`${material.type}-${material.id}`}\r\n                                onClick={() => {\r\n                                  if (!isSelected) {\r\n                                    handleAddMaterial(material.id);\r\n                                    setMaterialSearch(\"\");\r\n                                    setIsMaterialDropdownOpen(false);\r\n                                  }\r\n                                }}\r\n                                className={`flex items-center justify-between px-4 py-2 text-sm transition-colors group border-b border-border last:border-0 w-full ${\r\n                                  isSelected\r\n                                    ? \"bg-surface-highlight cursor-default\"\r\n                                    : \"hover:bg-surface-highlight cursor-pointer\"\r\n                                }`}\r\n                              >\r\n                                <div className=\"text-left\">\r\n                                  <p\r\n                                    className={`font-medium transition-colors ${\r\n                                      isSelected\r\n                                        ? \"text-text-muted\"\r\n                                        : \"text-text-main group-hover:text-primary-600\"\r\n                                    }`}\r\n                                  >\r\n                                    {material.name}\r\n                                  </p>\r\n                                  <p className=\"text-xs text-text-muted text-left\">\r\n                                    ${material.cost.toFixed(3)} / {material.unit}\r\n                                  </p>\r\n                                </div>\r\n                                {isSelected ? (\r\n                                  <div className=\"flex items-center gap-1 text-xs text-emerald-500 font-bold bg-emerald-500/10 px-2 py-1 rounded-full\">\r\n                                    <CheckCircle size={12} />\r\n                                    Ya seleccionado\r\n                                  </div>\r\n                                ) : (\r\n                                  <Plus\r\n                                    size={16}\r\n                                    className=\"text-primary-500 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                  />\r\n                                )}\r\n                              </button>\r\n                            );\r\n                          })}\r\n                        {allMaterials.filter((m) =>\r\n                          m.name\r\n                            .toLowerCase()\r\n                            .includes(materialSearch.toLowerCase()),\r\n                        ).length === 0 && (\r\n                          <div className=\"px-4 py-3 text-sm text-text-muted text-center\">\r\n                            No se encontraron materiales\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Selected Items List */}\r\n                  <div className=\"space-y-4\">\r\n                    <h4 className=\"text-sm font-bold text-text-main flex items-center justify-between\">\r\n                      <span>Materiales Seleccionados</span>\r\n                      <span className=\"text-xs font-normal text-text-muted bg-surface-highlight px-2 py-1 rounded-full\">\r\n                        {allSelectedItems.length} items\r\n                      </span>\r\n                    </h4>\r\n\r\n                    {allSelectedItems.length === 0 ? (\r\n                      <div className=\"text-center py-8 border-2 border-dashed border-border rounded-xl bg-surface-highlight/30\">\r\n                        <Beaker\r\n                          size={32}\r\n                          className=\"mx-auto text-text-muted/50 mb-2\"\r\n                        />\r\n                        <p className=\"text-sm text-text-muted\">\r\n                          No hay materiales seleccionados\r\n                        </p>\r\n                        <p className=\"text-xs text-text-muted/70 mt-1\">\r\n                          Usa el buscador para agregar productos\r\n                        </p>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"space-y-2 max-h-[400px] overflow-y-auto pr-1\">\r\n                        {allSelectedItems.map((item) => (\r\n                          <div\r\n                            key={`${item.type}-${item.id}`}\r\n                            className=\"flex items-center gap-3 p-3 bg-surface border border-border rounded-xl shadow-sm hover:border-primary-500/30 transition-all group\"\r\n                          >\r\n                            <div className=\"p-2 rounded-lg bg-indigo-50 text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-400\">\r\n                              <Package size={18} />\r\n                            </div>\r\n\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <p className=\"font-medium text-text-main text-sm truncate\">\r\n                                {item.name}\r\n                              </p>\r\n                              <p className=\"text-xs text-text-muted\">\r\n                                Costo: ${item.cost.toFixed(2)}\r\n                              </p>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <div className=\"flex items-center bg-surface-highlight rounded-lg border border-border\">\r\n                                <input\r\n                                  type=\"number\"\r\n                                  min=\"0\"\r\n                                  step=\"0.1\"\r\n                                  value={item.qty}\r\n                                  onChange={(e) => {\r\n                                    const val = parseFloat(e.target.value) || 0;\r\n                                    handleMaterialQtyChange(item.id, val);\r\n                                  }}\r\n                                  className=\"w-16 px-2 py-1 text-sm bg-transparent text-center focus:outline-none font-medium text-text-main\"\r\n                                />\r\n                                <span className=\"pr-2 text-xs text-text-muted border-l border-border pl-2 py-1 bg-surface-highlight rounded-r-lg\">\r\n                                  {item.unit}\r\n                                </span>\r\n                              </div>\r\n\r\n                              <button\r\n                                onClick={() => handleRemoveMaterial(item.id)}\r\n                                className=\"p-2 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors\"\r\n                                title=\"Eliminar\"\r\n                              >\r\n                                <Trash2 size={16} />\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Cost Summary Footer */}\r\n                  {allSelectedItems.length > 0 && (\r\n                    <div className=\"p-4 bg-surface-highlight rounded-xl border border-border flex justify-between items-center\">\r\n                      <span className=\"text-sm font-medium text-text-muted\">\r\n                        Costo Total Estimado\r\n                      </span>\r\n                      <span className=\"text-lg font-bold text-primary-600\">\r\n                        ${totalEstimatedMaterialCost.total.toFixed(2)}\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"p-4 border-t border-border bg-surface-highlight flex gap-3\">\r\n              <button\r\n                onClick={() => setEditingExtraItem(null)}\r\n                className=\"bg-background border border-border text-text-muted hover:bg-surface-highlight hover:text-text-main font-semibold rounded-xl px-4 py-2 transition-all flex-1\"\r\n              >\r\n                Cancelar\r\n              </button>\r\n              <button\r\n                onClick={handleSaveUnifiedExtra}\r\n                className=\"flex-1 px-4 py-3 rounded-xl bg-primary-600 text-white font-bold shadow-lg shadow-primary-600/20 hover:bg-primary-700 hover:shadow-xl hover:brightness-110 transition-all duration-200 active:scale-95 active:shadow-inner\"\r\n              >\r\n                {editingExtraItem.id === \"new\"\r\n                  ? \"Crear Extra\"\r\n                  : \"Guardar Cambios\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <ConfirmationModal\r\n        isOpen={confirmConfig.isOpen}\r\n        onClose={closeConfirmation}\r\n        onConfirm={confirmConfig.onConfirm}\r\n        title={confirmConfig.title}\r\n        message={confirmConfig.message}\r\n        isLoading={confirmConfig.isLoading}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\InventoryManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\ServicesManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\admin\\components\\tabs\\StaffManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\auth\\DeletedAccountScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\auth\\LicenseLogin.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\auth\\LoginScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\auth\\SuspendedAccountScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\finance\\FinanceScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\finance\\components\\PaymentDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\features\\staff\\StaffScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\hooks\\useAuth.ts","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'currentUser'. Either include it or remove the dependency array.","line":143,"column":6,"nodeType":"ArrayExpression","endLine":143,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [users, dataLoaded, currentUser]","fix":{"range":[5009,5028],"text":"[users, dataLoaded, currentUser]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\hooks\\usePhotoUpload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\hooks\\useSalonData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\services\\cloudinaryService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\services\\expenseService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\services\\inventoryService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\services\\salonService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\services\\userService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\utils\\helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\utils\\pinAttempts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\utils\\security.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VS\\App_Principal\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]